<UserControl
    x:Class="AioStudy.UI.Views.Components.SemesterCard"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:MaIc="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:AioStudy.UI.Views.Components"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Height="220"
    d:DesignHeight="220"
    d:DesignWidth="700"
    mc:Ignorable="d">

    <Border
        Margin="0,20,0,0"
        Padding="15,5,15,15"
        BorderThickness="2"
        CornerRadius="10">
        <Border.Effect>
            <DropShadowEffect
                x:Name="CardShadow"
                BlurRadius="4"
                Direction="270"
                Opacity="0.2"
                ShadowDepth="2"
                Color="Black" />
        </Border.Effect>

        <Border.Background>
            <LinearGradientBrush>
                <GradientStop Offset="0.0" Color="#1F2024" />
                <GradientStop Offset="1.0" Color="#1A1B1E" />
            </LinearGradientBrush>
        </Border.Background>

        <!--  Transform für Scaling hinzufügen  -->
        <Border.RenderTransform>
            <ScaleTransform x:Name="CardScale" ScaleX="1" ScaleY="1" />
        </Border.RenderTransform>

        <Border.BorderBrush>
            <LinearGradientBrush>
                <GradientStop Offset="0.0" Color="{Binding Color, TargetNullValue=#608BC1, FallbackValue=#608BC1}" />
                <GradientStop Offset="1.0" Color="#133E87" />
                <GradientStop Offset="0.5" Color="#6A8BA8" />
            </LinearGradientBrush>
        </Border.BorderBrush>

        <Border.Triggers>
            <!--  MouseEnter: Vergrößern + Farbe ändern  -->
            <EventTrigger RoutedEvent="MouseEnter">
                <BeginStoryboard>
                    <Storyboard>

                        <!--  DropShadow Animation  -->
                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="ShadowDepth"
                            To="3"
                            Duration="0:0:0.3">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="BlurRadius"
                            To="16"
                            Duration="0:0:0.3">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="Opacity"
                            To="0.5"
                            Duration="0:0:0.3">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <!--  Delete & Edit Buttons einblenden  -->
                        <DoubleAnimation
                            Storyboard.TargetName="DeleteButton"
                            Storyboard.TargetProperty="Opacity"
                            To="1.0"
                            Duration="0:0:0.12" />

                        <DoubleAnimation
                            Storyboard.TargetName="EditButton"
                            Storyboard.TargetProperty="Opacity"
                            To="1.0"
                            Duration="0:0:0.12" />
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>

            <!--  MouseLeave: Zurück zur normalen Größe + Farbe  -->
            <EventTrigger RoutedEvent="MouseLeave">
                <BeginStoryboard>
                    <Storyboard>

                        <!--  DropShadow zurück  -->
                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="ShadowDepth"
                            To="2"
                            Duration="0:0:0.2">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="BlurRadius"
                            To="4"
                            Duration="0:0:0.2">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="Opacity"
                            To="0.2"
                            Duration="0:0:0.2">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <!--  Delete & Edit Buttons ausblenden  -->
                        <DoubleAnimation
                            Storyboard.TargetName="DeleteButton"
                            Storyboard.TargetProperty="Opacity"
                            To="0"
                            Duration="0:0:0.16" />

                        <DoubleAnimation
                            Storyboard.TargetName="EditButton"
                            Storyboard.TargetProperty="Opacity"
                            To="0"
                            Duration="0:0:0.12" />
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
        </Border.Triggers>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="35" />
                <RowDefinition Height="1" />
                <RowDefinition Height="*" />
                <RowDefinition Height="31" />
            </Grid.RowDefinitions>

            <!--  Semester Info  -->
            <StackPanel
                Grid.Row="0"
                Grid.Column="0"
                Margin="0,0,0,6"
                VerticalAlignment="Center"
                Orientation="Horizontal">
                <MaIc:MaterialIcon
                    Width="30"
                    Height="30"
                    Margin="0,0,10,0"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"
                    Foreground="{Binding Color, TargetNullValue=#608BC1, FallbackValue=#608BC1}"
                    Kind="SchoolOutline" />
                <Rectangle
                    Width="2"
                    Height="20"
                    Margin="0,0,10,0"
                    VerticalAlignment="Center"
                    Fill="#30343E" />
                <TextBlock
                    FontSize="22"
                    FontWeight="SemiBold"
                    Foreground="#DEDEDE"
                    Text="{Binding Name, FallbackValue=TestSemster}"
                    UseLayoutRounding="True" />
            </StackPanel>


            <!--  Separator  -->
            <Border
                Grid.Row="1"
                Grid.ColumnSpan="9"
                Height="1"
                Background="#3A3D45" />

            <StackPanel
                Grid.Row="3"
                Height="16"
                Margin="0,10,0,0"
                Orientation="Horizontal">
                <TextBlock
                    FontSize="13"
                    Foreground="#B0B3BA"
                    Text="{Binding StartDateString, FallbackValue='20.02.2032'}"
                    UseLayoutRounding="True" />
                <MaIc:MaterialIcon
                    Width="13"
                    Height="13"
                    Margin="4,0,4,0"
                    Foreground="#545862"
                    Kind="ArrowForwardCircle" />
                <TextBlock
                    FontSize="13"
                    Foreground="#B0B3BA"
                    Text="{Binding EndDateString, FallbackValue='20.05.2032'}"
                    UseLayoutRounding="True" />
            </StackPanel>

            <StackPanel Grid.Row="2" Orientation="Horizontal">
                <!--  Module Count with better styling  -->
                <Border
                    Grid.Row="2"
                    Grid.Column="0"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"
                    HorizontalAlignment="Left"
                    Background="#2C3448"
                    BorderBrush="#3C4F7A"
                    BorderThickness="1"
                    CornerRadius="10">
                    <StackPanel
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <TextBlock
                            FontSize="14"
                            FontWeight="SemiBold"
                            Foreground="#AFC4FF"
                            Text="" />
                        <TextBlock
                            FontSize="14"
                            FontWeight="SemiBold"
                            Foreground="#E5E7EB"
                            Text="{Binding Converter={StaticResource ModuleCountConverter}}" />
                    </StackPanel>
                </Border>

                <!--  Studytime  -->
                <Border
                    Grid.Row="2"
                    Height="35"
                    Padding="12,6"
                    Background="#322C4A"
                    BorderBrush="#5D4E91"
                    BorderThickness="1"
                    CornerRadius="10">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            FontSize="14"
                            FontWeight="SemiBold"
                            Foreground="#D3BFFF"
                            Text="Studytime: " />
                        <TextBlock
                            FontSize="14"
                            FontWeight="SemiBold"
                            Foreground="#F4EFFF"
                            Text="{Binding Semester.LearnedSemesterMinutes, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource MinutesToStringConverter}, TargetNullValue='N/A'}" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!--  Action Buttons (Edit + Delete)  -->
            <StackPanel
                Grid.Row="3"
                Grid.Column="3"
                VerticalAlignment="Center"
                Orientation="Horizontal">
                <!--  Edit Button  -->
                <Button
                    x:Name="EditButton"
                    Width="30"
                    Height="30"
                    Command="{Binding OpenSemesterOverviewCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    CommandParameter="{Binding Semester, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Cursor="Hand"
                    Opacity="0"
                    Style="{StaticResource GrayGradientButton}"
                    ToolTip="Semester bearbeiten"
                    UseLayoutRounding="True">

                    <MaIc:MaterialIcon
                        Width="20"
                        Height="20"
                        Margin="0,0,0,0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Foreground="#787777"
                        Kind="OpenInNew"
                        SnapsToDevicePixels="True"
                        UseLayoutRounding="True" />
                </Button>

                <!--  Delete Button  -->
                <Button
                    x:Name="DeleteButton"
                    Width="30"
                    Height="30"
                    Margin="10,0,0,0"
                    Command="{Binding DeleteCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    CommandParameter="{Binding Semester, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Cursor="Hand"
                    Opacity="0"
                    Style="{StaticResource RedGradientButtonThinBorder}"
                    ToolTip="Semester löschen"
                    UseLayoutRounding="True">


                    <MaIc:MaterialIcon
                        Width="20"
                        Height="20"
                        Margin="0,0,0,0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Foreground="#8F7979"
                        Kind="DeleteOutline"
                        SnapsToDevicePixels="True"
                        UseLayoutRounding="True" />
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>