<UserControl
    x:Class="AioStudy.UI.Views.Components.SemesterCard"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:MaIc="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:AioStudy.UI.Views.Components"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Height="150"
    d:DesignHeight="150"
    d:DesignWidth="500"
    mc:Ignorable="d">

    <Border
        Margin="0,8"
        Padding="20"
        Background="#2A2D35"
        BorderThickness="2"
        CornerRadius="8"
        SnapsToDevicePixels="True"
        UseLayoutRounding="True">
        <Border.Effect>
            <DropShadowEffect
                x:Name="CardShadow"
                BlurRadius="4"
                Direction="270"
                Opacity="0.9"
                ShadowDepth="2"
                Color="Black" />
        </Border.Effect>

        <!--  Transform für Scaling hinzufügen  -->
        <Border.RenderTransform>
            <ScaleTransform x:Name="CardScale" ScaleX="1" ScaleY="1" />
        </Border.RenderTransform>

        <Border.BorderBrush>
            <LinearGradientBrush>
                <GradientStop Offset="0.0" Color="{Binding Color, TargetNullValue=#608BC1, FallbackValue=#608BC1}" />
                <GradientStop Offset="1.0" Color="#133E87" />
                <GradientStop Offset="0.5" Color="#a5bacc" />
            </LinearGradientBrush>
        </Border.BorderBrush>

        <Border.Triggers>
            <!--  MouseEnter: Vergrößern + Farbe ändern  -->
            <EventTrigger RoutedEvent="MouseEnter">
                <BeginStoryboard>
                    <Storyboard>

                        <!--  DropShadow Animation  -->
                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="ShadowDepth"
                            To="5"
                            Duration="0:0:0.3">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="BlurRadius"
                            To="16"
                            Duration="0:0:0.3">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="Opacity"
                            To="0.5"
                            Duration="0:0:0.3">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <!--  Delete & Edit Buttons einblenden  -->
                        <DoubleAnimation
                            Storyboard.TargetName="DeleteButton"
                            Storyboard.TargetProperty="Opacity"
                            To="1.0"
                            Duration="0:0:0.12" />

                        <DoubleAnimation
                            Storyboard.TargetName="EditButton"
                            Storyboard.TargetProperty="Opacity"
                            To="1.0"
                            Duration="0:0:0.12" />
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>

            <!--  MouseLeave: Zurück zur normalen Größe + Farbe  -->
            <EventTrigger RoutedEvent="MouseLeave">
                <BeginStoryboard>
                    <Storyboard>

                        <!--  DropShadow zurück  -->
                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="ShadowDepth"
                            To="2"
                            Duration="0:0:0.2">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="BlurRadius"
                            To="4"
                            Duration="0:0:0.2">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <DoubleAnimation
                            Storyboard.TargetName="CardShadow"
                            Storyboard.TargetProperty="Opacity"
                            To="0.2"
                            Duration="0:0:0.2">
                            <DoubleAnimation.EasingFunction>
                                <QuadraticEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>

                        <!--  Delete & Edit Buttons ausblenden  -->
                        <DoubleAnimation
                            Storyboard.TargetName="DeleteButton"
                            Storyboard.TargetProperty="Opacity"
                            To="0"
                            Duration="0:0:0.16" />

                        <DoubleAnimation
                            Storyboard.TargetName="EditButton"
                            Storyboard.TargetProperty="Opacity"
                            To="0"
                            Duration="0:0:0.12" />
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
        </Border.Triggers>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!--  Semester Info  -->
            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                <TextBlock
                    Margin="0,0,0,4"
                    FontSize="20"
                    FontWeight="SemiBold"
                    Foreground="White"
                    Text="{Binding Name, FallbackValue=TestSemster}"
                    UseLayoutRounding="True" />

                <TextBlock
                    Margin="0,0,0,6"
                    FontSize="13"
                    Foreground="#B0B3BA"
                    UseLayoutRounding="True">
                    <TextBlock.Text>
                        <MultiBinding StringFormat="📅 {0} - {1}">
                            <Binding Path="StartDateString" />
                            <Binding Path="EndDateString" />
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>

                <TextBlock
                    FontSize="11"
                    Foreground="#8A8D95"
                    Text="{Binding CreatedString, StringFormat='🕒 Erstellt: {0}'}"
                    UseLayoutRounding="True" />
            </StackPanel>

            <!--  Module Count with better styling  -->
            <Border
                Grid.Column="2"
                Margin="20,0"
                Padding="12,6"
                VerticalAlignment="Center"
                Background="#4A90E2"
                CornerRadius="12"
                SnapsToDevicePixels="True"
                UseLayoutRounding="True">
                <StackPanel Orientation="Horizontal">
                    <MaIc:MaterialIcon
                        Width="16"
                        Height="16"
                        Margin="0,0,6,0"
                        Foreground="White"
                        Kind="BookOpenPageVariant" />
                    <TextBlock
                        FontSize="12"
                        FontWeight="Medium"
                        Foreground="White"
                        Text="{Binding Converter={StaticResource ModuleCountConverter}}"
                        UseLayoutRounding="True" />
                </StackPanel>
            </Border>

            <!--  Action Buttons (Edit + Delete)  -->
            <StackPanel
                Grid.Column="3"
                VerticalAlignment="Center"
                Orientation="Horizontal">
                <!--  Edit Button (initially hidden)  -->
                <Button
                    x:Name="EditButton"
                    Width="26"
                    Height="26"
                    Command="{Binding OpenSemesterOverviewCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    CommandParameter="{Binding Semester, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Cursor="Hand"
                    Opacity="1"
                    Style="{StaticResource GrayGradientButton}"
                    ToolTip="Semester bearbeiten"
                    UseLayoutRounding="True">

                    <MaIc:MaterialIcon
                        Width="20"
                        Height="20"
                        Margin="0,0,0,0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Foreground="#787777"
                        Kind="EyeOutline"
                        SnapsToDevicePixels="True"
                        UseLayoutRounding="True" />
                </Button>

                <!--  Delete Button (initially hidden)  -->
                <Button
                    x:Name="DeleteButton"
                    Width="26"
                    Height="26"
                    Margin="5,0,0,0"
                    Command="{Binding DeleteCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    CommandParameter="{Binding Semester, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Cursor="Hand"
                    Opacity="1"
                    Style="{StaticResource RedGradientButtonThinBorder}"
                    ToolTip="Semester löschen"
                    UseLayoutRounding="True">


                    <MaIc:MaterialIcon
                        Width="20"
                        Height="20"
                        Margin="0,0,0,0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Foreground="#8F7979"
                        Kind="DeleteOutline"
                        SnapsToDevicePixels="True"
                        UseLayoutRounding="True" />
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>